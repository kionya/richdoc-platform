// ì´ íŒŒì¼ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ êµ¬ì¡°ë¥¼ ì •ì˜í•˜ëŠ” ì„¤ê³„ë„ì…ë‹ˆë‹¤.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL") // Vercelìš© ì£¼ì†Œ
  directUrl = env("POSTGRES_URL_NON_POOLING") // Vercelìš© ì§í†µ ì£¼ì†Œ
}

// 1. ì‚¬ìš©ì (í™˜ì + ë³‘ì› ê´€ë¦¬ì + ìµœê³  ê´€ë¦¬ì)
model User {
  id            String    @id @default(uuid()) // ê³ ìœ  ID ìë™ìƒì„±
  email         String    @unique              // ì´ë©”ì¼ì€ ì¤‘ë³µ ë¶ˆê°€
  password      String?                        // ë¹„ë°€ë²ˆí˜¸ (ì†Œì…œ ë¡œê·¸ì¸ ì‹œ ì—†ì„ ìˆ˜ ìˆìŒ)
  role          String    @default("PATIENT")  // ì—­í• : PATIENT, HOSPITAL, ADMIN
  name          String?
  phone         String?
  country       String?   @default("KR")       // êµ­ê°€ ì½”ë“œ
  
  leads         Lead[]                         // ì´ ì‚¬ëŒì´ ì‹ ì²­í•œ ìƒë‹´ ë‚´ì—­ë“¤
  
  createdAt     DateTime  @default(now())      // ê°€ì…ì¼
  updatedAt     DateTime  @updatedAt           // ìˆ˜ì •ì¼
}

// 2. ë³‘ì› ì •ë³´
model Hospital {
  id            String      @id @default(uuid())
  name          String      // ë³‘ì› ì´ë¦„
  location      String?     // ì£¼ì†Œ (ê°•ë‚¨êµ¬ ë…¼í˜„ë™...)
  description   String?     // ë³‘ì› ì†Œê°œ
  isPartner     Boolean     @default(false)      // ì œíœ´ ë³‘ì› ì—¬ë¶€
  commission    Float       @default(15.0)       // ìˆ˜ìˆ˜ë£Œìœ¨ (ê¸°ë³¸ 15%)
  
  treatments    Treatment[] // ì´ ë³‘ì›ì˜ ì‹œìˆ  ìƒí’ˆë“¤
  leads         Lead[]      // ì´ ë³‘ì›ì— ì ‘ìˆ˜ëœ ìƒë‹´ë“¤
  
  createdAt     DateTime    @default(now())
}

// 3. ì‹œìˆ  ìƒí’ˆ (ì˜ˆ: ìš¸ì„ë¼ 300ìƒ·, ì½”ìˆ˜ìˆ  ë“±)
model Treatment {
  id            String    @id @default(uuid())
  name          String    // ì‹œìˆ ëª…
  category      String    // ì¹´í…Œê³ ë¦¬ (í”¼ë¶€, ì„±í˜•, ì¹˜ê³¼...)
  priceMin      Int       // ìµœì†Œ ê°€ê²©
  priceMax      Int       // ìµœëŒ€ ê°€ê²©
  description   String?   // ì‹œìˆ  ìƒì„¸ ì„¤ëª…
  
  hospitalId    String    // ì–´ëŠ ë³‘ì› ìƒí’ˆì¸ì§€ ì—°ê²°
  hospital      Hospital  @relation(fields: [hospitalId], references: [id])
  
  createdAt     DateTime  @default(now())
}

// 4. ìƒë‹´/ì˜ˆì•½ (Lead) - ë¹„ì¦ˆë‹ˆìŠ¤ì˜ í•µì‹¬!
model Lead {
  id            String    @id @default(uuid())
  referralCode  String    @unique // ë‚˜ì¤‘ì— QRì½”ë“œë¡œ ë§Œë“¤ ê³ ìœ  ë²ˆí˜¸
  
  status        String    @default("PENDING") 
  // ìƒíƒœê°’: PENDING(ì ‘ìˆ˜) -> VISITED(ë‚´ì›) -> DONE(ì‹œìˆ ì™„ë£Œ/ê²°ì œ) -> CANCELLED
  
  concern       String?   // í™˜ìì˜ ê³ ë¯¼ (ì˜ˆ: "ì½”ê°€ ë‚®ì•„ìš”")
  quotedPrice   Int?      // í™•ì •ëœ ê²¬ì  ê¸ˆì•¡
  
  photo         String?   // ğŸ‘ˆ [ì¶”ê°€] ì‚¬ì§„ ë°ì´í„°ë¥¼ ì €ì¥í•  ì¹¸ (Base64 ë¬¸ìì—´)

  userId        String    // ì‹ ì²­í•œ í™˜ì ID
  user          User      @relation(fields: [userId], references: [id])
  
  hospitalId    String?   // ì§€ì •ëœ ë³‘ì› ID (ì—†ìœ¼ë©´ ë¯¸ì§€ì •)
  hospital      Hospital? @relation(fields: [hospitalId], references: [id])

  settlement    Settlement? // ì •ì‚° ë‚´ì—­ (1:1 ì—°ê²°)
  
  visitedAt     DateTime? // ë³‘ì› ë°©ë¬¸ ì‹œê°„
  createdAt     DateTime  @default(now())
}

// 5. ì •ì‚° (ëˆ ê´€ë¦¬)
model Settlement {
  id            String    @id @default(uuid())
  amount        Int       // ì´ ê²°ì œ ê¸ˆì•¡
  fee           Int       // ìš°ë¦¬ê°€ ê°€ì ¸ê°ˆ ìˆ˜ìˆ˜ë£Œ
  isPaid        Boolean   @default(false) // ë³‘ì›ì´ ìš°ë¦¬í•œí…Œ ì…ê¸ˆ í–ˆëŠ”ì§€ ì—¬ë¶€
  
  leadId        String    @unique // ì–´ë–¤ ìƒë‹´ ê±´ì— ëŒ€í•œ ì •ì‚°ì¸ì§€
  lead          Lead      @relation(fields: [leadId], references: [id])
  
  createdAt     DateTime  @default(now())
}
// ğŸ‘‡ ë§¨ ì•„ë˜ì— ì¶”ê°€í•˜ì„¸ìš”!
model Consultation {
  id        String   @id @default(uuid())
  customerName String?
  phone     String
  content   String
  imageUrl  String?
  password  String?
  createdAt DateTime @default(now())
}